<!-- <ion-header [translucent]="true">
  <ion-toolbar>
    <p class="regidter-toolbar">עצמאי בעצמי - לחסוך כסף להרוויח זמן!</p>
  </ion-toolbar>
</ion-header> -->

<ion-content [fullscreen]="true">

  <div class="register-content">
    <ng-container *ngIf="authService.error$ | async as errorType">
      <ng-container [ngSwitch]="errorType">
        <ng-container *ngSwitchCase=" 'email' ">
          <p class="text-error">
            כתובת מייל לא חוקית
          </p>
        </ng-container>
        <ng-container *ngSwitchCase=" 'user' ">
          <p class="text-error">
            לא ניתן להירשם עם מייל זה
            <br>
            כתובת המייל כבר קיימת במערכת
          </p>
        </ng-container>
        <ng-container *ngSwitchCase=" 'net' ">
          <p class="text-error">אין חיבור לאינטרנט אנא נסה מאוחר יותר

          </p>
        </ng-container>
        <ng-container *ngSwitchCase=" 'disabled' ">
          <p class="text-error">
            לא ניתן לשלוח אימות למייל
            <br>
            חשבון משתמש מושבת / לא קיים חשבון מייל כזה במערכת
          </p>
        </ng-container>
        <ng-container *ngSwitchCase=" 'many' ">
          <p class="text-error">
            לא ניתן לשלוח כעת אימות למייל
            <br>
            אנא נסה מאוחר יותר
          </p>
        </ng-container>
      </ng-container>
    </ng-container>

    <app-item-navigate class="navigate-item-container" [navigationItems]="itemsNavigate"
      (onNavButtonClicked)="navigateclicked($event)"></app-item-navigate>

    <!-------------- PRESONAL MODULE ------------->
    <ng-container [ngSwitch]="selectedFormModule">
      <ng-container *ngSwitchCase="registerFormModules.PERSONAL">
        <form *ngIf="personalForm" class="form-register" [formGroup]="personalForm">
          <!---------first name----->
          <app-generic-input inputLabel="שם פרטי" [controlName]="registerFormControls.FIRSTNAME" [parentForm]="personalForm"></app-generic-input>
          <!--------last name------->
          <app-generic-input inputLabel="שם משפחה" [controlName]="registerFormControls.LASTNAME" [parentForm]="personalForm"></app-generic-input>
          <!-------id number------->
          <app-generic-input inputLabel="תעודת זהות" [controlName]="registerFormControls.ID" [parentForm]="personalForm"></app-generic-input>
          <!-----email ---->
          <app-generic-input inputType="email" inputLabel="כתובת מייל" [controlName]="registerFormControls.EMAIL" [parentForm]="personalForm"></app-generic-input>
          <!----phone ----->
          <app-generic-input inputType="tel" inputLabel="מספר פלאפון" [controlName]="registerFormControls.PHONE" [parentForm]="personalForm"></app-generic-input>
          <!-----date of birth----->
          <app-generic-input inputType="date" inputLabel="תאריך לידה" [controlName]="registerFormControls.DATEOFBIRTH" [parentForm]="personalForm"></app-generic-input>
          <!---------city ----->
          <!-- <ion-select class="input-register" formControlName="city" label="עיר" placeholder="עיר" label-placement="floating" fill="outline"  interface="action-sheet">
              <ion-select-option *ngFor="let city of cities">{{city.name}}</ion-select-option>
            </ion-select> -->
          <ion-item class="generic-ionic-selectable-wrapper">
            <ion-label>עיר</ion-label>
            <ionic-selectable
              class="generic-ionic-selectable-content"
              formControlName="city"
              [shouldFocusSearchbar]="true"
              [searchDebounce]="1"
              [items]="cities ?? []"
              itemValueField="name"
              itemTextField="name"
              [canSearch]="true"
              (onChange)="portChange($event)">
            </ionic-selectable>
          </ion-item>
          <!--------------- employee ------------->
          <app-generic-select [controlName]="registerFormControls.EMPLOYEE" title="סטטוס תעסוקתי" [items]="EmploymentStatusList" [parentForm]="personalForm"></app-generic-select>
          <!--------- family status----->
          <app-generic-select [controlName]="registerFormControls.FAMILYSTATUS" title="מצב משפחתי" [items]="familyStatusOptionsList" [parentForm]="personalForm"></app-generic-select>
        </form>
      </ng-container>

      <!-------------- SPOUSE MODULE ------------->
      <ng-container *ngSwitchCase="registerFormModules.SPOUSE">
        <form *ngIf="spouseForm" class="form-register" [formGroup]="spouseForm">
          <!---------first name----->
          <app-generic-input inputLabel="שם פרטי בן / בת הזוג" [controlName]="registerFormControls.SPOUSEFIRSTNAME" [parentForm]="spouseForm"></app-generic-input>
          <!--------last name------->
          <app-generic-input inputLabel="שם משפחה" [controlName]="registerFormControls.SPOUSELASTNAME" [parentForm]="spouseForm"></app-generic-input>
          <!-------id number------->
          <app-generic-input inputLabel="תעודת זהות" [controlName]="registerFormControls.SPOUSEID" [parentForm]="spouseForm"></app-generic-input>
          <!----phone ----->
          <app-generic-input inputType="tel" inputLabel="מספר פלאפון" [controlName]="registerFormControls.SPOUSEPHONE" [parentForm]="spouseForm"></app-generic-input>
          <!-----date of birth----->
          <app-generic-input inputType="date" inputLabel="תאריך לידה" [controlName]="registerFormControls.SPOUSEDATEOFBIRTH" [parentForm]="spouseForm"></app-generic-input>
          <!--------------- employee ------------->
          <app-generic-select [controlName]="registerFormControls.SPOUSEINDEPENDET" title="סטטוס תעסוקתי" [items]="EmploymentStatusList" [parentForm]="spouseForm"></app-generic-select>
        </form>
      </ng-container>

      <!-------------- CHILDREN MODULE ------------->
        <ng-container *ngSwitchCase="registerFormModules.CHILDREN">
          <ng-container *ngIf="childrenArray.controls.length == 0; else children">
            <app-button buttonText="הוסף ילד" iconName="add-circle-outline" iconPosition="end" [buttonClass]="ButtonClass.CLEAR" (onButtonClicked)="addChild()"></app-button>
          </ng-container>
          <ng-template #children>
          <form *ngIf="childrenForm" class="form-register" [formGroup]="childrenForm">
            <!-- add ngIf childrenArray length  == 0 display button to add child else  -->
            <div [formArrayName]="registerFormControls.CHILDREN">
              <div *ngFor="let child of childrenArray.controls; let i = index" [formGroupName]="i" class="child-row">
                <!-------Fname of child----->
                <app-generic-input class="input-register-child" inputLabel="שם פרטי של הילד" [controlName]="registerFormControls.CHILD_FIRST_NAME" [parentForm]="getChildFormByIndex(i)"></app-generic-input>
                <!-------Lname of child----->
                <app-generic-input class="input-register-child" inputLabel="שם משפחה של הילד" [controlName]="registerFormControls.CHILD_LAST_NAME" [parentForm]="getChildFormByIndex(i)"></app-generic-input>
                <!-------id of child----->
                <app-generic-input class="input-register-child" inputLabel="תעודת זהות של הילד" [controlName]="registerFormControls.CHILD_ID" [parentForm]="getChildFormByIndex(i)"></app-generic-input>
                <!-------dateBirth of child----->
                <app-generic-input class="input-register-child" inputType="date" inputLabel="תאריך לידה" [controlName]="registerFormControls.CHILD_DATE_OF_BIRTH" [parentForm]="getChildFormByIndex(i)"></app-generic-input>
                <!------- buttons add and remove child----->
                <app-button class="child-button" aria-label="הוסף ילד" iconName="add-outline" [buttonSize]="ButtonSize.X_SMALL" [buttonClass]="ButtonClass.ICON_ONLY" (onButtonClicked)="addChild()"></app-button>
                <app-button class="child-button" aria-label="הסר ילד" iconName="remove-outline" [buttonSize]="ButtonSize.X_SMALL" [buttonClass]="ButtonClass.ICON_ONLY" [buttonStyle]="{}" (onButtonClicked)="removeChild(i)"></app-button>
              </div>
            </div>
          </form>
        </ng-template>
        </ng-container>
        

        <!-------------- BUSINESS MODULE ------------->
        <ng-container *ngSwitchCase="registerFormModules.BUSINESS">
          <form *ngIf="businessForm" class="form-register" [formGroup]="businessForm">
            <!-------Business name------>
            <ion-input class="input-register" type="text" label="שם עסק" label-placement="floating" fill="outline"
              placeholder="הכנס שם עסק" fill="outline"
              [formControlName]="registerFormControls.BUSINESSNAME"></ion-input>
            <!--------------- Business fields ------------->
            <ion-select [formControlName]="registerFormControls.BUSINESSFIELD" class="input-register" label="תחום העסק"
              fill="outline" label-placement="floating" interface="popover">
              <ion-select-option *ngFor="let option of listBusinessField"
                [value]="option.key">{{option.value}}</ion-select-option>
            </ion-select>
            <!--------------- Business type ------------->
            <ion-select [formControlName]="registerFormControls.BUSINESSTYPE" class="input-register" label="סוג העסק"
              fill="outline" label-placement="floating" interface="popover">
              <ion-select-option *ngFor="let option of listBusinessType"
                [value]="option.key">{{option.value}}</ion-select-option>
            </ion-select>
            <!-------Business id------>
            <ion-input class="input-register" type="text" label="מספר עסק" label-placement="floating" fill="outline"
              placeholder="מספר עוסק / ח.פ ספק" [formControlName]="registerFormControls.BUSINESSID"></ion-input>
            <!------- business date ----->
            <ion-input class="input-register" type="date" label-placement="floating" fill="outline"
              label="תאריך פתיחת עסק" [formControlName]="registerFormControls.BUSINESSDATE"></ion-input>
            <!------- business inventory ----->
            <ion-select [formControlName]="registerFormControls.BUSINESSINVENTORY" class="input-register"
              label="האם העסק מנהל מלאי?" fill="outline" label-placement="floating" interface="popover">
              <ion-select-option *ngFor="let option of employeeList"
                [value]="option.value">{{option.name}}</ion-select-option>
            </ion-select>
          </form>
        </ng-container>

        <!-------------- VALIDATION MODULE ------------->
        <ng-container *ngSwitchCase="registerFormModules.VALIDATION">
          <form *ngIf="validationForm" class="form-register-validate" [formGroup]="validationForm">
            <ion-label>סיסמא חייבת לכלול שני תווים באנגלית ומספרים ולהיות לפחות באורך של שמונה תווים</ion-label>
            <ion-input class="input-register" (ionInput)="checkPassword()" type="text" label="סיסמא"
              label-placement="floating" fill="outline" placeholder="בחר סיסמא" formControlName="password"></ion-input>
            <ion-label *ngIf="!(this.passwordValid)">סיסמאות לא זהות</ion-label>
            <ion-input class="input-register" (ionInput)="changePasswordValidinput($event)" (ionInput)="checkPassword()"
              type="text" label="אימות סיסמא" label-placement="floating" fill="outline"
              placeholder="הכנס את הסיסמא פעם נוספת"></ion-input>
          </form>
        </ng-container>

    </ng-container>
    <div>
      <app-button buttonText="חזור" [disabled]="selectedFormModule === registerFormModules.PERSONAL"
        (onButtonClicked)="onBackBtnClicked()"></app-button>
      <app-button [buttonText]="buttonNextText"
        [disabled]="isNextButtonDisabled"
        (onButtonClicked)="onNextBtnClicked()"></app-button>
    </div>
    <div>
      משתמש קיים? לחץ <span (click)="navigateToLogin()" class="blue-link">כאן</span> לכניסה.
    </div>
  </div>
  <p>
  </p>
</ion-content>