<div class="register-screen">

  <div class="register-wrap-module">

    <ng-container [ngSwitch]="selectedFormModule()">
      <div class="content">
        <div class="header">
          <img class="logo" src="../../../assets/login_logo.svg" alt="Logo" height="20">
          <span class="level">{{ level() }}</span>
          <div class="title">
            <span class="main-title">{{ mainTitle() }}</span>
            <span class="title">{{ subtitle() }}</span>
          </div>
        </div>

        <!-------------- PRESONAL MODULE ------------->
        <div class="module" *ngSwitchCase="registerFormModules.PERSONAL">

          <!-- <form *ngIf="personalForm" class="form-register" [formGroup]="personalForm"> -->
          @if(personalForm) {
          <div class="form-register">
            <!-- First line -->
            <div class="section-one">
              <!---------first name----->
              <app-input-text [controlName]="registerFormControls.FIRSTNAME" labelText="שם פרטי"
                [placeholder]="'כתוב כאן'" [parentForm]="personalForm" [size]="inputsSize.BETWEEN"
                [customStyle]="'fill-border'" [errorText]="'אנא הכנס תווים בלבד'"></app-input-text>
              <!--------last name------->
              <app-input-text [controlName]="registerFormControls.LASTNAME" labelText="שם משפחה"
                [placeholder]="'כתוב כאן'" [parentForm]="personalForm" [size]="inputsSize.BETWEEN"
                [customStyle]="'fill-border'" [errorText]="'אנא הכנס תווים בלבד'"></app-input-text>
              <!-------id number------->
              <app-input-text [controlName]="registerFormControls.ID" labelText="תעודת זהות" [placeholder]="'000000000'"
                [parentForm]="personalForm" [size]="inputsSize.BETWEEN" [customStyle]="'fill-border'"
                [errorText]="'נא הכנס מספר באורך 9 ספרות'"></app-input-text>
            </div>
            <!-- Second line -->
            <div class="section-one">
              <!-----email ---->
              <app-input-text [controlName]="registerFormControls.EMAIL" labelText="כתובת אימייל"
                [placeholder]="'example@gmail.com'" [parentForm]="personalForm" [size]="inputsSize.BETWEEN"
                [customStyle]="'fill-border'" [errorText]="'כתובת המייל אינה חוקית'"></app-input-text>
              <!-----date of birth----->
              <app-input-date [controlName]="registerFormControls.DATEOFBIRTH" labelText="תאריך לידה"
                placeholder="00/00/0000" [parentForm]="personalForm" [customStyle]="'register'"></app-input-date>
              <!----phone ----->
              <app-input-text [controlName]="registerFormControls.PHONE" labelText="מספר פלאפון"
                [placeholder]="'050-0011223'" [parentForm]="personalForm" [size]="inputsSize.BETWEEN"
                [customStyle]="'fill-border'" [errorText]="'מספר פלאפון לא חוקי'"></app-input-text>
            </div>
            <!-- Third line -->
            <div class="section-one">
              <!-- city -->
              <app-input-select [controlName]="registerFormControls.CITY" labelText="ישוב" [placeholder]="'בחר ישוב'"
                [items]="cities()" [parentForm]="personalForm" [size]="inputsSize.BETWEEN" [customStyle]="'register'"
                [virtualScroll]="true"></app-input-select>
              <!-- gender -->
              <form [formGroup]="personalForm" class="gender-selection">
                <label class="gender-label">מגדר</label>
                <div class="radio-buttons-container">
                  <div class="gender-button">
                    <p-radiobutton inputId="female" value="female" formControlName="gender" />
                    <label for="female">נקבה</label>
                  </div>

                  <div class="gender-button">
                    <p-radiobutton inputId="male" value="male" formControlName="gender" />
                    <label for="male">זכר</label>
                  </div>
                </div>
              </form>
            </div>
            <!-- Fourth line -->
            <div class="section-one">
              <!---------------- family status -------------->
              <app-input-select [controlName]="registerFormControls.FAMILYSTATUS" labelText="מצב משפחתי"
                [placeholder]="'בחר/י'" [items]="familyStatusOptionsList" [parentForm]="personalForm"
                [size]="inputsSize.BETWEEN" [customStyle]="'register'"></app-input-select>
              <!--------------- employee status ------------->
              <app-input-select [controlName]="registerFormControls.EMPLOYEMENTSTATUS" labelText="סטטוס תעסוקתי"
                [placeholder]="'בחר/י'" [items]="employmentTypeOptionsList" [parentForm]="personalForm"
                [size]="inputsSize.BETWEEN" [customStyle]="'register'"></app-input-select>
            </div>
            <!-- Fifth line -->
            <div class="section-one">
              <app-input-text [controlName]="registerFormControls.PASSWORD" labelText="סיסמה"
                [placeholder]="'בחר 8 תווים'" [parentForm]="personalForm" [size]="inputsSize.BETWEEN"
                [customStyle]="'fill-border'" [errorText]="'סיסמא לא חוקית'"></app-input-text>
              <app-input-text [controlName]="registerFormControls.CONFIRM_PASSWORD" labelText="אימות סיסמה"
                [placeholder]="'בחר 8 תווים'" [parentForm]="personalForm" [size]="inputsSize.BETWEEN"
                [customStyle]="'fill-border'" [errorText]="'אימות סיסמא לא תקין'"></app-input-text>
              <span class="password-instracions">על הסיסמה להכיל שמונה תווים<br>המורכבים מאותיות באנגלית
                ומספרים</span>
            </div>
          </div>
          }
          <!-- </form> -->
        </div>

        <!-------------- SPOUSE MODULE ------------->
        <div class="module" *ngSwitchCase="registerFormModules.SPOUSE">
          @if(spouseForm) {
          <div class="form-register">
            <!-- First line -->
            <div class="section-one">
              <!---------first name----->
              <app-input-text [controlName]="registerFormControls.SPOUSEFIRSTNAME" labelText="שם פרטי"
                [placeholder]="'כתוב כאן'" [parentForm]="spouseForm" [size]="inputsSize.BETWEEN"
                [customStyle]="'fill-border'" [errorText]="'אנא הכנס תווים בלבד'"></app-input-text>
              <!--------last name------->
              <app-input-text [controlName]="registerFormControls.SPOUSELASTNAME" labelText="שם משפחה"
                [placeholder]="'כתוב כאן'" [parentForm]="spouseForm" [size]="inputsSize.BETWEEN"
                [customStyle]="'fill-border'" [errorText]="'אנא הכנס תווים בלבד'"></app-input-text>
              <!-------id number------->
              <app-input-text [controlName]="registerFormControls.SPOUSEID" labelText="תעודת זהות"
                [placeholder]="'000000000'" [parentForm]="spouseForm" [size]="inputsSize.BETWEEN"
                [customStyle]="'fill-border'" [errorText]="'נא הכנס מספר באורך 9 ספרות'"></app-input-text>
            </div>
            <!-- Second line -->
            <div class="section-one">
              <!-----email ---->
              <app-input-text [controlName]="registerFormControls.SPOUSEEMAIL" labelText="כתובת אימייל"
                [placeholder]="'example@gmail.com'" [parentForm]="spouseForm" [size]="inputsSize.BETWEEN"
                [customStyle]="'fill-border'" [errorText]="'כתובת המייל אינה חוקית'"></app-input-text>
              <!-----date of birth----->
              <app-input-date [controlName]="registerFormControls.SPOUSEDATEOFBIRTH" labelText="תאריך לידה"
                placeholder="00/00/0000" [parentForm]="spouseForm" [customStyle]="'register'"></app-input-date>
              <!----phone ----->
              <app-input-text [controlName]="registerFormControls.SPOUSEPHONE" labelText="מספר פלאפון"
                [placeholder]="'050-0011223'" [parentForm]="spouseForm" [size]="inputsSize.BETWEEN"
                [customStyle]="'fill-border'" [errorText]="'מספר פלאפון לא חוקי'"></app-input-text>
            </div>
            <!-- Third line -->
            <div class="section-one">
              <!--------------- employee ------------->
              <app-input-select [controlName]="registerFormControls.SPOUSEEMPLOYEMENTSTATUS" labelText="סטטוס תעסוקתי"
                [placeholder]="'בחר/י'" [items]="employmentTypeOptionsList" [parentForm]="spouseForm"
                [size]="inputsSize.BETWEEN"></app-input-select>
              <!-- gender -->
              <form [formGroup]="spouseForm" class="gender-selection">
                <label class="gender-label">מגדר</label>
                <div class="radio-buttons-container">
                  <div class="gender-button">
                    <p-radiobutton inputId="female" value="female" formControlName="spouseGender" />
                    <label for="female">נקבה</label>
                  </div>

                  <div class="gender-button">
                    <p-radiobutton inputId="male" value="male" formControlName="spouseGender" />
                    <label for="male">זכר</label>
                  </div>
                </div>
              </form>
            </div>
          </div>
          }
        </div>

        <!-------------- CHILDREN MODULE ------------->
        <div class="module" *ngSwitchCase="registerFormModules.CHILDREN">

            <div>
              <p>יש לך ילדים?</p>
              <p-toggleswitch [(ngModel)]="hasChildren" (onChange)="handleHasChildrenChange($event.checked)" />
            </div>
            @if (hasChildren()) {
            <div class="form-register">
              <form class="children-form" *ngIf="childrenForm" [formGroup]="childrenForm">
                <div class="child-row-wrap" formArrayName="childrenArray">
                  @for (child of childrenArray.controls; track $index) {
                  @let i = $index;
                  <div [formGroupName]="i" class="child-row">
                    <div class="child-row">
                      <app-input-text [controlName]="registerFormControls.CHILD_FIRST_NAME" labelText="שם פרטי"
                        [placeholder]="'כתוב כאן'" [parentForm]="getChildFormByIndex(i)" [size]="inputsSize.BETWEEN"
                        [customStyle]="'fill-border'" [errorText]="'אנא הכנס תווים בלבד'"></app-input-text>
                      <app-input-text [controlName]="registerFormControls.CHILD_LAST_NAME" labelText="שם משפחה"
                        [placeholder]="'כתוב כאן'" [parentForm]="getChildFormByIndex(i)" [size]="inputsSize.BETWEEN"
                        [customStyle]="'fill-border'" [errorText]="'אנא הכנס תווים בלבד'"></app-input-text>
                      <app-input-date [controlName]="registerFormControls.CHILD_DATE_OF_BIRTH" labelText="תאריך לידה"
                        placeholder="00/00/0000" [parentForm]="getChildFormByIndex(i)" [customStyle]="'register'"></app-input-date>

                    <div class="wrap-add-remove-child-button">
                      @if (canDeleteChild(i)) {
                      <app-p-button [buttonText]="'-'" [buttonSize]="buttonSize.AUTO" [buttonColor]="buttonColor.YELLOW"
                        (onButtonClicked)="removeChild(i)"></app-p-button>
                      }
                    </div>
                  </div>
                </div>
                }
              </div>
            </form>
          </div>
          }
        </div>

        <!-------------- BUSINESS MODULE ------------->
        <div class="module" *ngSwitchCase="registerFormModules.BUSINESS">

            <div class="form-register">
              <form class="business-form" *ngIf="businessForm" [formGroup]="businessForm">
                <div class="business-row-wrap" formArrayName="businessArray">
                  @for (business of businessArray.controls; track $index) {
                    @let i = $index;
                    <div [formGroupName]="i" class="business-block">
                      <!-- ✅ Title row -->
                      <div class="business-title">
                        {{ business.get('title')?.value }}
                      </div>

                      <!-- ✅ Inputs row -->
                      <div class="business-row">
                        <app-input-text
                          [controlName]="registerFormControls.BUSINESSNAME"
                          labelText="שם העסק"
                          [placeholder]="'כתוב כאן'"
                          [parentForm]="getBusinessFormByIndex(i)"
                          [size]="inputsSize.BETWEEN"
                          [customStyle]="'fill-border'">
                        </app-input-text>

                        <app-input-text
                          [controlName]="registerFormControls.BUSINESSNUMBER"
                          labelText="מספר העסק"
                          [placeholder]="'כתוב כאן'"
                          [parentForm]="getBusinessFormByIndex(i)"
                          [size]="inputsSize.BETWEEN"
                          [customStyle]="'fill-border'"
                          [errorText]="'אנא הכנס מספרים בלבד'">
                        </app-input-text>

                        <app-input-select
                          [controlName]="registerFormControls.BUSINESSTYPE"
                          labelText="סוג העסק"
                          [placeholder]="'בחר/י'"
                          [items]="businessTypeOptionsList"
                          [parentForm]="getBusinessFormByIndex(i)"
                          [size]="inputsSize.BETWEEN">
                        </app-input-select>

                        <div class="wrap-add-remove-business-button">
                          @if (businessArray.controls.length > 1) {
                            <app-p-button
                              [buttonText]="'-'"
                              [buttonSize]="buttonSize.AUTO"
                              [buttonColor]="buttonColor.YELLOW"
                              (onButtonClicked)="removeBusiness(i)">
                            </app-p-button>
                          }
                        </div>
                      </div>
                    </div>
                  }
                </div>

                <app-p-button
                  [buttonText]="'+'"
                  [buttonSize]="buttonSize.AUTO"
                  [buttonColor]="buttonColor.YELLOW"
                  (onButtonClicked)="addBusiness()">
                </app-p-button>
              </form>
            </div>


            <!-- <div class="business-title" *ngIf="businessForm && isIndependent()">פרטי עסק משתמש/ת ראשי/ת</div>
            <form *ngIf="businessForm && isIndependent()" class="form-register" [formGroup]="businessForm">
              <div class="section-one"> -->
                <!-------Business name------>
                <!-- <app-input-text [controlName]="registerFormControls.BUSINESSNAME" labelText="שם העסק"
                  [placeholder]="'כתוב כאן'" [parentForm]="businessForm" [size]="inputsSize.BETWEEN"
                  [customStyle]="'fill-border'"></app-input-text> -->
                <!-------Business id------>
                <!-- <app-input-text [controlName]="registerFormControls.BUSINESSNUMBER" labelText="מספר העסק"
                  [placeholder]="'כתוב כאן'" [parentForm]="businessForm" [size]="inputsSize.BETWEEN"
                  [customStyle]="'fill-border'" [errorText]="'אנא הכנס מספרים בלבד'"></app-input-text> -->
                <!--------------- Business type ------------->
                <!-- <app-input-select [controlName]="registerFormControls.BUSINESSTYPE" labelText="סוג העסק"
                  [placeholder]="'בחר/י'" [items]="businessTypeOptionsList" [parentForm]="businessForm"
                  [size]="inputsSize.BETWEEN"></app-input-select>
              </div>
            </form> -->
            <!-- </div> -->
            <!-------Business 2 ------>
            <!-- <div class="wrap-one-detial-business"> -->
            <!-- <div class="business-title" *ngIf="businessForm && isSpouseIndependent()">פרטי עסק בן/בת הזוג</div>
            <form *ngIf="businessForm && isSpouseIndependent()" class="form-register" [formGroup]="businessForm">
              <div class="section-one"> -->
                <!-------Business name------>
                <!-- <app-input-text [controlName]="registerFormControls.SPOUSEBUSINESSNAME" labelText="שם העסק"
                  [placeholder]="'כתוב כאן'" [parentForm]="businessForm" [size]="inputsSize.BETWEEN"
                  [customStyle]="'fill-border'"></app-input-text> -->
                <!-------Business id------>
                <!-- <app-input-text [controlName]="registerFormControls.SPOUSEBUSINESSNUMBER" labelText="מספר העסק"
                  [placeholder]="'כתוב כאן'" [parentForm]="businessForm" [size]="inputsSize.BETWEEN"
                  [customStyle]="'fill-border'" [errorText]="'אנא הכנס מספרים בלבד'"></app-input-text> -->
                <!--------------- Business type ------------->
                <!-- <app-input-select [controlName]="registerFormControls.SPOUSEBUSINESSTYPE" labelText="סוג העסק"
                  [placeholder]="'בחר/י'" [items]="businessTypeOptionsList" [parentForm]="businessForm"
                  [size]="inputsSize.BETWEEN"></app-input-select>
              </div>
            </form> -->
            <!-- </div> -->
          </div>
        </div>
      </ng-container>

    <!---------- Buttons ------------->
    <div class="footer">
      <div class="buttons-footer">
        <app-p-button [buttonText]="selectedFormModule() === registerFormModules.PERSONAL ? 'ביטול' : 'חזור'"
          [buttonSize]="buttonSize.BETWEEN" [buttonColor]="buttonColor.WHITE_BORDER"
          (onButtonClicked)="selectedFormModule() === registerFormModules.PERSONAL ? navigateToLogin() : onBackBtnClicked() "></app-p-button>
        <app-p-button
          [buttonText]="selectedFormModule() === registerFormModules.BUSINESS  || (isSingle() && !isIndependent() ) ? 'סיום' : 'הבא'"
          [buttonSize]="buttonSize.BETWEEN" [buttonColor]="buttonColor.YELLOW" (onButtonClicked)="onNextBtnClicked()"
          [disabled]="isNextButtonDisabled" [isLoading]="isLoading()"></app-p-button>
      </div>
      <div class="login-link">
        <p>יש לכם כבר חשבון?</p>
        <app-p-button [buttonText]="'כניסה לחשבון'" [variant]="'text'" [severity]="'info'"
          [buttonSize]="buttonSize.AUTO" [link]="'/login'"></app-p-button>
      </div>
    </div>
  </div>

  @let imgData = matchRegisterImage();
  <div class="register-picture">
    <div [class]="imgData?.posText === 'top' ? 'image-text position-top' : 'image-text position-bottom'">
      <h1 class="image-title" [style.color]="imgData?.colorText">{{ imgData?.title }}</h1>
      <p class="image-subtitle" [style.color]="imgData?.colorText">
        {{ imgData?.subTitle }}
      </p>
    </div>
    <div>
      <img [src]="imgData?.src" [alt]="imgData?.alt" class="register-image" />
    </div>
  </div>

</div>