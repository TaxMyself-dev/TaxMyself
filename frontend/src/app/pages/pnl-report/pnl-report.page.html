<app-custom-toolbar></app-custom-toolbar>



<ion-content [fullscreen]="true">
  <div class="wrap-screen">
    <app-search-bar class="generic-searchbar-wrapper" (onSearchClick)="onSubmit()" [customTemplate]="pnlReportTemplate"
      [isDisabled]="pnlReportForm.invalid">
    </app-search-bar>

    <ng-container *ngIf="!pnlReport">
      <p class="text-before-report">
        אנא בחר חודשי דיווח ומלא הכנסות על מנת ליצור דו"ח
      </p>
    </ng-container>

    <ng-container *ngIf="pnlReport">
      <div class="field-report">
        <p>דו"ח רווח והפסד</p>
        <p>עבור עסק: {{userData.businessName}}</p>
        <p>לתאריך: {{endDate}} - {{startDate}}</p>
      </div>
      <div class="wrap-output-report">
        <p class="report-title">נתוני דו"ח רווח והפסד</p>
        <!-- Display Income -->
        <div class="output-pnl-report">
          <div class="field-report">סך הכל הכנסות לפני מע"מ:</div>
          <div class="input-container">
            <ion-input color="light"  class="input-value" [(ngModel)]="pnlReport.income" (ionInput)="updateIncome($event)"></ion-input>
          </div>
        </div>
        <!-- Dynamically Display Expenses -->
        <ng-container *ngFor="let category of pnlReport.expenses">
          <div class="output-pnl-report">
            <div class="field-report">{{ category.category }}:</div>
            <div class="value-field-report">{{ category.total | number }}</div>
          </div>
        </ng-container>
        <!-- Display Net Profit Before Tax -->
        <div class="output-pnl-report">
          <div class="field-report">רווח נקי לפני מס:</div>
          <div class="value-field-report" dir="ltr">{{ pnlReport.netProfitBeforeTax }}</div>
        </div>
      </div>
    </ng-container>
  </div>

  <app-button buttonText="Create PDF" (onButtonClicked)="createPDF()"></app-button>
</ion-content>

<ng-template #pnlReportTemplate>
  <form class="generic-search-bar-content" [formGroup]="pnlReportForm">
    <app-select-report-period class="pnl-report-search-bar-input" (onSelectionChange)="setFormValidators($event)" [parentForm]="pnlReportForm" [title]="'תקופת דיווח'"></app-select-report-period>
    <app-select-year class="pnl-report-search-bar-input" [parentForm]="pnlReportForm"></app-select-year>
    <!-- <app-select-month class="pnl-report-search-bar-input" [parentForm]="pnlReportForm"></app-select-month> -->

    <app-select-month 
    *ngIf="this.pnlReportForm.get('reportingPeriodType').value != reportingPeriodType.DATE_RANGE && 
           this.pnlReportForm.get('reportingPeriodType').value != reportingPeriodType.ANNUAL" [parentForm]="pnlReportForm" class="pnl-report-search-bar-input">
    </app-select-month>

    <!-- <app-generic-input [controlName]="'taxableTurnover'" [inputLabel]="'הכנסה חייבת'"
      [parentForm]="pnlReportForm"></app-generic-input> -->
      <app-generic-select class="pnl-report-search-bar-input" *ngIf="userData.isTwoBusinessOwner" [items]="businessNames" [parentForm]="pnlReportForm" [title]="'בחר עסק'" [controlName]="'businessNumber'"></app-generic-select> 

  </form>
</ng-template>

<!-- <ion-toast [isOpen]="isToastOpen" [message]="messageToast" [duration]="4000" (didDismiss)="setCloseToast()"></ion-toast> -->
